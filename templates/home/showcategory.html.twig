{% extends 'base.html.twig' %}

{% block title %}Shortmessage - Category: {{posts[0].category}}{% endblock %}

{% block body %}
<br>

{% for message in app.flashes('erfolg') %}
    <div class="alert alert-success"><h3>{{ message }}</h3></div>
{% endfor %}

{% for post in pagination %}
  <div class="card">
    <div class="card-header">
      {{post.name}}
    </div>
    <div class="card-body" id="{{ post.id }}">
      <blockquote class="blockquote mb-0">
        <p>{{post.text}}</p>
        <footer class="blockquote-footer">{{post.date}} by {{post.authorid}} - Category: {{post.category}} - 
        <button id="likes-{{post.id}}" class="like-btn" onclick="likePost({{post.id}})">{{post.likecount}}</button> | 
        <button id="dislikes-{{post.id}}" class="dislike-btn" onclick="dislikePost({{post.id}})">{{post.dislikecount}}</button>
        </footer>
      </blockquote>
    </div>
  </div>
  <br>



        {% endfor %}

            {{ knp_pagination_render(pagination) }}
        

{% block javascripts %}
    {{ parent() }}
    <script>
        function likePost(postId) {
            sendAjaxRequest('thumpsup', postId);


        }

        function dislikePost(postId) {
            sendAjaxRequest('thumpsdown', postId);
        }

        function sendAjaxRequest(action, postId) {
          console.log('Sending ${action} request for ${postId}')
            const xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    // Hier kannst du die RÃ¼ckgabe verarbeiten, z.B. die Like/Dislike-Anzahl aktualisieren
                    const response = JSON.parse(xhr.responseText);
                    //const postElement = document.querySelector(`.post[data-post-id="${postId}"]`);
                    document.getElementById("likes-"+`${postId}`).textContent = response.likes;
                    console.log(response.dislikes)
                    console.log(`${postId}`)
                    document.getElementById("dislikes-"+`${postId}`).textContent = response.dislikes;
                }
            };

            xhr.open('GET', `/${action}/${postId}`, true);
            xhr.send();
        }
    </script>
{% endblock %}

{% endblock %}
